## Сбор логов в среде Ред Виртуализация

Скрипт предназначен для сбора данных логов в среде Ред Виртуализация (oVirt) Сбор логов осуществляется с управляющей ВМ Engine и гипервизоров. Также логи собираются с хоста в варианте установки Standalone.

С управляющей ВМ Engine на выбор пользователя копируютя логи только из каталога /var/log/ovirt-engine и ряд других целевых логов или копируется целиком каталог /var/log.
Логи ВМ Engine, относящиеся к среде Ред Виртуализация:
* /var/log/ovirt-engine - Каталог с лог файлами "engine.log", отображающими проблемы с GUI Ovirt-Engine, поиском в Active Directory, базой данных и другие события.
* /var/log/ovirt-engine/host-deploy - Каталог с логами от развернутых гипервизоров.
* /var/log/ovirt-engine/setup" - Каталог с установочными логами ovirt-engine
* /var/log/httpd/ovirt-requests-log - Логи обращений по https к Engine с указанием времени ожидания запроса. Поле «Correlation-Id» позволяет соотносить запросы с логом /var/log/ovirt-engine/engine.log
* /var/log/ovirt-provider-ovn.log - лог регистрации действий сетевого провайдера OVN

С гипервизоров на выбор пользователя копируютя логи только из каталога /var/log/vdsm или копируется целиком каталог /var/log.
Логи гипервизоров, относящиеся к среде Ред Виртуализация:
* /var/log/messages - Данный лог используется службой libvirt. Для просмотра можно воспользоваться утилитой  journalctl.
* /var/log/vdsm/spm-lock.log - Лог, отображающий  активность хоста о работе ролью менеджера пула хранения (SPM). В логе содержится информация о том, когда хост принял, отдал, обновил или не смог обновить аренду роли SPM.
* /var/log/vdsm/import/import-UUID-Date.log - Лог с подробностями виртуальной машины, импортированной из сред KVM, RHEL5 Xen или провайдера или провайдера VMware.
* /var/log/vdsm/upgrade.log - Лог используется менеджером VDSM во время обновления хоста для регистрации изменений конфигурации.
* /var/log/vdsm/mom.log - Лог регистрирует активность менеджера оверкоммита памяти (MoM) менеджера VDSM
* /var/log/libvirt/qemu/ - Каталог с логами службы libvirt по каждой ВМ, запущенной на данном гипервизоре.

 
Скрипт запускается из управляющей ВМ Engine под правами администратора (root).
Перед запуском скрипта проверить права на исполнение:  
*ls -l ovirt-log-collect.sh*  
При необходимости выдать права на исполнение командой:  
*chmod +x ovirt-log-collect.sh*

**Внимание: Размер логов гипервизоров может быть достаточно большим - до нескольких ГБ. Рекомендуется убедиться в наличии дсотаточного места в каталоге откуда запускается скрипт, собирать логи в ограниченном режиме (с каталога /var/log/ovirt-engine для управляющей ВМ и /var/log/vdsm для гипервизоров), а также только с нужных гипервизоров**

Скрипт работает в интерактивном режиме:
* Выбрать режим сбора логов с локальной ВМ Engine. Полный (весь каталог /var/log) или ограниченный (каталог /var/log/ovirt-engine + целевые логи)
* Выбрать гипервизоры, с которых необходимо собрать логи (все или только нужные). 
* Выбрать режим сбора логов с гипервизоров. Полный (весь каталог /var/log) или ограниченный - только (каталог /var/log/vdsm)

Результат работы скрипта выводится на экран и сохраняется в сжатом архивном файле: "ovirt-logs-yyyymmdd.tar.gz"
*- где "yyyymmdd" - время создания файла*

Распакуйте сжатый архивный файл в выделенный каталог "ovirt-logs-yyyymmdd" командой:
*tar -xzvf ovirt-logs-yyyymmdd.tar.gz*

Работоспособность скрипта протестирована с версией "Ред Виртуализация 7.3" (oVirt 4.4)